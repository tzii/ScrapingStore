<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCRAPE_STORE // v.3.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #0c0c0c;
            --bg-panel: #111;
            --term-green: #00ff41;
            --term-amber: #ffb000;
            --term-cyan: #00f3ff;
            --term-red: #ff3333;
            --term-dim: #444;
            --border: #333;
            --glow: 0 0 10px rgba(0, 243, 255, 0.1);
            --font: 'Fira Code', monospace;
        }

        * {
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: var(--term-dim) var(--bg);
        }

        body {
            background-color: var(--bg);
            color: #ccc;
            font-family: var(--font);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            font-size: 13px;
        }

        /* Scanline Overlay */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 900;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .crt::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0;
            z-index: 900;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% {
                opacity: 0.027951;
            }

            5% {
                opacity: 0.044171;
            }

            10% {
                opacity: 0.034875;
            }

            15% {
                opacity: 0.010263;
            }

            20% {
                opacity: 0.046187;
            }

            25% {
                opacity: 0.030836;
            }

            30% {
                opacity: 0.016335;
            }

            35% {
                opacity: 0.027003;
            }

            40% {
                opacity: 0.054415;
            }

            45% {
                opacity: 0.084799;
            }

            50% {
                opacity: 0.057393;
            }

            55% {
                opacity: 0.007559;
            }

            60% {
                opacity: 0.035445;
            }

            65% {
                opacity: 0.018995;
            }

            70% {
                opacity: 0.0574;
            }

            75% {
                opacity: 0.018503;
            }

            80% {
                opacity: 0.005432;
            }

            85% {
                opacity: 0.0033;
            }

            90% {
                opacity: 0.030993;
            }

            95% {
                opacity: 0.022941;
            }

            100% {
                opacity: 0.050607;
            }
        }

        /* Top Bar */
        nav {
            background: #000;
            border-bottom: 1px solid var(--border);
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            z-index: 1000;
        }

        .nav-brand {
            color: var(--term-cyan);
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 0 5px var(--term-cyan);
        }

        .nav-status {
            color: var(--term-green);
        }

        .blink {
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        /* Main Grid */
        main {
            flex: 1;
            display: grid;
            grid-template-columns: 280px 1fr 340px;
            grid-template-rows: 1fr 1fr;
            gap: 1px;
            background: var(--border);
            padding: 1px;
        }

        /* Panel Styling */
        .panel {
            background: var(--bg);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            background: #1a1a1a;
            padding: 8px 12px;
            font-size: 11px;
            color: #888;
            border-bottom: 1px solid var(--border);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            justify-content: space-between;
        }

        .panel-content {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
        }

        /* ASCII Chart Bars */
        .chart-row {
            display: flex;
            margin-bottom: 8px;
            align-items: center;
            font-size: 11px;
        }

        .chart-label {
            width: 80px;
            color: #888;
            text-align: right;
            padding-right: 10px;
        }

        .chart-bar-container {
            flex: 1;
            display: flex;
            align-items: center;
        }

        .chart-bar {
            height: 14px;
            background: var(--bg);
            color: var(--term-cyan);
            white-space: nowrap;
            overflow: hidden;
            font-family: monospace;
            text-shadow: 0 0 2px var(--term-cyan);
        }

        .chart-value {
            margin-left: 8px;
            color: #fff;
        }

        /* Franchise List */
        .fran-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px dashed #333;
            font-size: 12px;
        }

        .fran-item:last-child {
            border: none;
        }

        .fran-name {
            color: var(--term-amber);
        }

        .fran-count {
            color: #fff;
        }

        /* KPI Box */
        .kpi-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .kpi-box {
            border: 1px solid var(--border);
            padding: 15px;
            text-align: center;
        }

        .kpi-title {
            font-size: 10px;
            color: #666;
            margin-bottom: 5px;
        }

        .kpi-val {
            font-size: 24px;
            color: #fff;
            font-weight: 700;
        }

        .kpi-sub {
            font-size: 10px;
            color: var(--term-green);
            margin-top: 5px;
        }

        /* Log Feed */
        .log-line {
            font-size: 12px;
            padding: 3px 0;
            border-left: 2px solid transparent;
            padding-left: 6px;
        }

        .log-line:hover {
            border-left-color: var(--term-cyan);
            background: #111;
        }

        .log-ts {
            color: #555;
            margin-right: 8px;
        }

        .log-msg {
            color: #aaa;
        }

        .log-success {
            color: var(--term-green);
        }

        /* Grid spans */
        .col-span-2 {
            grid-column: span 2;
        }

        .row-span-2 {
            grid-row: span 2;
        }

        /* Fancy Prompt */
        .prompt {
            padding: 15px;
            border-top: 1px solid var(--border);
            background: #080808;
            color: #888;
        }

        .prompt span {
            color: var(--term-cyan);
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 14px;
            background: var(--term-green);
            vertical-align: middle;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>

<body class="crt">

    <nav>
        <div class="nav-brand">./TERMINAL_PF_V3</div>
        <div class="nav-status">SYSTEM_ONLINE <span class="blink">●</span></div>
    </nav>

    <main>
        <!-- LEFT PANEL: SYSTEM STATS -->
        <div class="panel row-span-2">
            <div class="panel-header">
                <span>01_SYSTEM_METRICS</span>
                <span>[X]</span>
            </div>
            <div class="panel-content">
                <div style="margin-bottom: 25px;">
                    <div style="font-size: 10px; color: #666; margin-bottom: 5px;">CPU_THREAD_01</div>
                    <div style="height: 4px; background: #222; width: 100%;">
                        <div style="height: 100%; width: 45%; background: var(--term-green);"></div>
                    </div>
                </div>
                <div style="margin-bottom: 25px;">
                    <div style="font-size: 10px; color: #666; margin-bottom: 5px;">MEMORY_ALLOC</div>
                    <div style="height: 4px; background: #222; width: 100%;">
                        <div style="height: 100%; width: 62%; background: var(--term-cyan);"></div>
                    </div>
                </div>

                <div class="kpi-wrapper">
                    <div class="kpi-box">
                        <div class="kpi-title">TOTAL_ITEMS</div>
                        <div class="kpi-val" id="t-count">0</div>
                        <div class="kpi-sub">▲ 100%</div>
                    </div>
                    <div class="kpi-box">
                        <div class="kpi-title">AVG_PRICE</div>
                        <div class="kpi-val" id="t-price">0.0</div>
                        <div class="kpi-sub">EUR</div>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <div class="panel-header" style="background: transparent; padding-left: 0; margin-bottom: 10px;">
                        TOP_FRANCHISES</div>
                    <div id="franchise-list">
                        <!-- JS populated -->
                    </div>
                </div>
            </div>
        </div>

        <!-- CENTER PANEL: VISUALIZATION -->
        <div class="panel col-span-2">
            <div class="panel-header">
                <span>02_DATA_VISUALIZATION.exe</span>
                <span>[ _ □ X ]</span>
            </div>
            <div class="panel-content" style="display: flex; gap: 30px;">
                <div style="flex: 1;">
                    <div style="margin-bottom: 15px; color: var(--term-cyan);">>> PRICE_DISTRIBUTION_HISTOGRAM</div>
                    <div id="ascii-chart">
                        <!-- JS populated -->
                    </div>
                </div>
                <div style="width: 200px; border-left: 1px dashed #333; padding-left: 20px;">
                    <div style="margin-bottom: 10px; color: var(--term-amber);">>> STATUS_REPORT</div>
                    <div style="font-size: 11px; line-height: 1.6; color: #999;">
                        Scrape complete.<br>
                        <span id="rep-count">0/0</span> Items Processed.<br>
                        0 Errors.<br>
                        Data integrity: 100%.<br>
                        <br>
                        Exporting to CSV... OK<br>
                        Generating graph... OK
                    </div>
                </div>
            </div>
        </div>

        <!-- BOTTOM CENTER: LOGS -->
        <div class="panel">
            <div class="panel-header">
                <span>03_EVENT_LOG</span>
                <span>[↑↓]</span>
            </div>
            <div class="panel-content" id="log-feed" style="font-family: monospace;">
                <!-- JS populated -->
            </div>
        </div>

        <!-- BOTTOM RIGHT: INTERACTIVE SHELL -->
        <div class="panel">
            <div class="panel-header">
                <span>04_TERMINAL</span>
                <span>[_]</span>
            </div>
            <div class="panel-content" style="padding: 0;">
                <div style="padding: 10px; height: 100%; background: #000;">
                    <div style="color: #666; margin-bottom: 10px;">Last login: {{ timestamp }} on ttys001</div>
                    <div>
                        <span style="color: var(--term-green);">user@scrapestore</span>:<span
                            style="color: var(--term-cyan);">~</span>$ ./analyze_data.py --verbose
                    </div>
                    <div style="color: #ccc; margin: 5px 0;">Running analysis routines...</div>
                    <div style="color: #ccc;">> Calculating vectors... done</div>
                    <div style="color: #ccc;">> Rendering ASCII... done</div>
                    <br>
                    <div>
                        <span style="color: var(--term-green);">user@scrapestore</span>:<span
                            style="color: var(--term-cyan);">~</span>$ <span class="blink">█</span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- DATA INJECTED ---
        const products = {{ products_json | safe }};

        // --- CALC KPI ---
        const total = products.length;
        const avg = products.reduce((acc, p) => acc + p.price, 0) / (total || 1);

        document.getElementById('t-count').innerText = total;
        document.getElementById('t-price').innerText = avg.toFixed(1);
        document.getElementById('rep-count').innerText = `${total}/${total}`;

        // --- ASCII CHARTS DIYNAMIC ---
        const bins = [60, 70, 80, 85, 90, 95];
        const counts = new Array(bins.length).fill(0);

        products.forEach(p => {
            // Matching logic to modern dashboard
            if (p.price < 60) counts[0]++;
            else if (p.price < 70) counts[1]++;
            else if (p.price < 80) counts[2]++;
            else if (p.price < 85) counts[3]++;
            else if (p.price < 90) counts[4]++;
            else counts[5]++;
        });

        const chartDiv = document.getElementById('ascii-chart');

        counts.forEach((count, idx) => {
            const range = bins[idx] ? `<${bins[idx]}` : `>${bins[idx - 1]}`;
            const row = document.createElement('div');
            row.className = 'chart-row';

            // Create bar using block characters
            let bar = '';
            // Scale bar if count is huge (e.g. 3000 items)
            // Limit max width to ~50 chars
            const maxVal = Math.max(...counts);
            const scale = maxVal > 50 ? 50 / maxVal : 1;

            const numBlocks = Math.ceil(count * scale);

            for (let i = 0; i < numBlocks; i++) bar += '█';

            // Add gradient effect using opacity (simulated with characters)
            if (count > (20 / scale)) bar += '▓▓';
            else if (count > (10 / scale)) bar += '▒▒';
            else bar += '░';

            row.innerHTML = `
                <div class="chart-label">${range} €</div>
                <div class="chart-bar-container">
                    <div class="chart-bar" style="width: ${numBlocks * 10}px; max-width: 100%;">${bar}</div>
                    <div class="chart-value">${count}</div>
                </div>
            `;
            chartDiv.appendChild(row);
        });

        // --- FRANCHISE LIST ---
        // Top 5 franchises
        const keywords = ['Zelda', 'Mario', 'Metal Gear', 'Gran Turismo', 'Halo', 'Persona', 'Starcraft', 'Uncharted'];
        const franchises = keywords.map(k => {
            return {
                name: k.toUpperCase(),
                count: products.filter(p => p.name.includes(k)).length
            };
        }).sort((a, b) => b.count - a.count).slice(0, 5);

        const franList = document.getElementById('franchise-list');
        franchises.forEach(f => {
            const row = document.createElement('div');
            row.className = 'fran-item';
            row.innerHTML = `<span class="fran-name">${f.name}</span> <span class="fran-count">[${f.count}]</span>`;
            franList.appendChild(row);
        });

        // --- LOG FEED ---
        const logFeed = document.getElementById('log-feed');
        let logIdx = 0;

        function addLog() {
            if (logIdx >= products.length) return;
            const p = products[logIdx];
            const div = document.createElement('div');
            div.className = 'log-line';
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });

            div.innerHTML = `
                <span class="log-ts">[${time}]</span>
                <span class="log-msg">Processed: ${p.name.substring(0, 20)}...</span>
                <span class="log-success">OK (${p.price}€)</span>
            `;
            logFeed.insertBefore(div, logFeed.firstChild);
            if (logFeed.children.length > 20) logFeed.removeChild(logFeed.lastChild);

            logIdx++;
            // Speed up log feed for large datasets
            let delay = 3000 / products.length; // aim for 3 seconds total
            if (delay < 10) delay = 10;
            if (delay > 500) delay = 500;

            setTimeout(addLog, delay);
        }

        setTimeout(addLog, 1000);

    </script>
</body>

</html>